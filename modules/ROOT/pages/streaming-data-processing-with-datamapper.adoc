= Streaming Data Processing with DataMapper
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:keywords: datamapper
include::partial$eol-warning.adoc[]

[NOTE]
DataMapper will continue to be fully supported in all current and future versions of Mule ESB 3.x, however it will be removed in Mule 4.0. We recommend that if you wish to take advantage of the new capabilities of xref:3.8@dataweave.adoc[DataWeave] or if you start new projects, upgrade now. However, if you have no pressing need to take advantage of new functionality, we recommend you wait until Mule 4.0 is released.


Especially useful when working with large datasets, Anypoint DataMapper supports streaming data input and output. For example, when reading information from a very large input file, you can use streaming you avoid having DataMapper load the whole file into memory. Instead, DataMapper works as a pipeline: it sequentially reads the file and store the data in a cache, performs data mapping, sends the output to the next transformer, empties the cache, then begins again. Using this procedure, DataMapper can parse a 500 MB CSV file using only about 75 MB of RAM, resulting in significant improvements in performance and resources utilization.

* Anypoint DataMapper streaming supports CSV and fixed width input and output formats.
* You can configure the size of the stream cache to optimize for performance.

== Assumptions

This document assumes the reader is familiar with the Anypoint DataMapper Transformer. If you are not, start from the beginning:  xref:6.x@studio::datamapper-user-guide-and-reference.adoc[DataMapper User Guide and Reference]. For a listing of all available tools in DataMapper, consult xref:5.x@studio::datamapper-visual-reference.adoc[DataMapper Visual Reference].

 View DataMapper Documentation Table of Contents

* xref:5.x@studio::datamapper-concepts.adoc[DataMapper Concepts]
* xref:5.x@studio::datamapper-visual-reference.adoc[DataMapper Visual Reference]
* xref:defining-datamapper-input-and-output-metadata.adoc[Defining DataMapper Input and Output Metadata]
** xref:defining-metadata-using-edit-fields.adoc[Defining Metadata Using Edit Fields]
** xref:pojo-class-bindings-and-factory-classes.adoc[POJO Class Bindings and Factory Classes]
* xref:building-a-mapping-flow-in-the-graphical-mapping-editor.adoc[Building a Mapping Flow in the Graphical Mapping Editor]
** xref:mapping-flow-input-and-output-properties.adoc[Mapping Flow Input and Output Properties]
** xref:5.x@studio::datamapper-input-error-policy-for-bad-input-data.adoc[DataMapper Input Error Policy for Bad Input Data]
** xref:using-datamapper-lookup-tables.adoc[Using DataMapper Lookup Tables]
** xref:streaming-data-processing-with-datamapper.adoc[Streaming Data Processing with DataMapper]
* xref:updating-metadata-in-an-existing-mapping.adoc[Updating Metadata in an Existing Mapping]
* xref:5.x@studio::mapping-elements-inside-lists.adoc[Mapping Elements Inside Lists]
* xref:5.x@studio::previewing-datamapper-results-on-sample-data.adoc[Previewing DataMapper Results on Sample Data]
* xref:5.x@studio::datamapper-examples.adoc[DataMapper Examples]
* xref:5.x@studio::datamapper-supplemental-topics.adoc[DataMapper Supplemental Topics]
** xref:choosing-mel-or-ctl2-as-scripting-engine.adoc[Choosing MEL or CTL2 as Scripting Engine]
** xref:5.x@studio::datamapper-fixed-width-input-format.adoc[DataMapper Fixed Width Input Format]
** xref:5.x@studio::datamapper-flat-to-structured-and-structured-to-flat-mapping.adoc[DataMapper Flat-to-Structured and Structured-to-Flat Mapping]

== Setting Streaming in DataMapper

To set the Streaming parameter in your data mapping flow, follow these steps:

. In the DataMapper view, click the *Properties* icon (highlighted below).
+
image::datamapper1.png[]

. DataMapper displays the general configuration dialog, shown below. Click *Streaming*.
+
image::datamapper2.png[]

.  In the *Pipe Size* input field, enter the desired size of the cache. The default is 2048. Bear in mind that:
* When working with files, the value of *Pipe Size* is expressed in bytes
* When working with collections, the value is expressed in number of collection elements

=== Handling Exceptions

If an exception occurs in the mapping, DataMapper stops the streaming engine as soon as possible. To avoid undesired consequences in case of failure (such as inserting only part of a row into a database) use xref:transactions-configuration-reference.adoc[Transactions].

== Example

This example illustrates the use of the Streaming feature in Anypoint DataMapper.

An xref:http-connector.adoc[HTTP Connector] receives a CSV file, then passes it to DataMapper. DataMapper maps the input data from CSV to POJO. A xref:database-connector.adoc[Database Connector] inserts the data into an external database.  In this scenario, DataMapper and the Database connector work in parallel as a pipeline, further improving application performance.

image::datamapper3.jpg[3]

The image below displays the DataMapper view as configured for this example.

image::datamapper4.jpg[4]

Finally, the output connector receives the list of maps, then incorporates each item as a value in the SQL query for the external database.

[source,text,linenums]
----
INSERT INTO Persons (name, city, email, phone) VALUES (#[payload.name], #[payload.city], #[payload.email], #[payload.phone])
----